# Use "screen-256color" if you get warning about terminal not fully functional.
#
# It is the best widely-available option for TERM in Tmux but lacks support for
# Tmux background-color-erase and status line features.
#
# `tmux-256color` is a more accurate definition for Tmux but its newer so older
# systems make lack support for it.
set -s default-terminal "xterm-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Reduce escape time to zero to allow for faster key entry after entering command.
set -s escape-time 0

# Automatically set window titles.
set-window-option -g automatic-rename on
set-option -g set-titles on

# Renumber window numbers when a window is closed.
set-option -g renumber-windows on

# Start counting from one rather than zero (lines up with keyboard 1-9, 0)
set -g base-index 1
set -g pane-base-index 1

# Use shift left/right/up/down to navigate panes
bind -n S-Left select-pane -L
bind -n S-Right select-pane -R
bind -n S-Up select-pane -U
bind -n S-Down select-pane -D

# Use ctrl shift left, shift right to move between windows.
bind -n C-S-Left previous-window
bind -n C-S-Right next-window

# Prefix + Shift C is kill window (opposite of prefix + c)
unbind C
bind C kill-window

# Replace tmux prefix with CTRL+space
unbind C-b
set -g prefix C-Space
bind Space send-prefix

# Split windows with h (horizontal) and v (vertical)
bind h split-window -h
bind v split-window -v

# Enable mouse support
set -g mouse on

# Reload tmux config with prefix + r
bind r source-file ~/.tmux.conf \; display-message ".tmux.conf reloaded"

#--------------------------------------------------------------------------------------------------#
# Status bar config                                                                                #
#--------------------------------------------------------------------------------------------------#
set -g @SB_BG black
set -g @SB_FG brightwhite
set -g @SB_HOSTNAME_BG black
set -g @SB_HOSTNAME_FG blue
set -g @SB_ACTIVE_WIN_BG magenta
set -g @SB_ACTIVE_WIN_FG black
set -g @SB_INACTIVE_WIN_BG black
set -g @SB_INACTIVE_WIN_FG gray

#--------------------------------------------------------------------------------------------------#
# Dynamic status values                                                                            #
#--------------------------------------------------------------------------------------------------#
# shortened hostname
run-shell 'tmux set -g @SB_HOSTNAME "$(shostname)"'

# SSH icon
if-shell '[ -n "$SSH_CLIENT" ] || [ -n "$SSH_TTY" ]' "set -g @SB_SSH ''" "set -g @SB_SSH '󰇅'"

#--------------------------------------------------------------------------------------------------#
# Status bar layout                                                                                #
#--------------------------------------------------------------------------------------------------#
set -g status-position top
set -g status-style bg="#{@SB_BG}",fg="#{@SB_FG}"

## Window status format.
# default format (e.g., non-active)
setw -g window-status-format "\
#[bg=#{@SB_INACTIVE_WIN_BG},fg=#{@SB_INACTIVE_WIN_FG}]\
#I#W\
#{?window_bell_flag,󰂚,}\
#{?window_zoomed_flag,,}\
#{?window_activity_flag,@,}\
#{?window_marked_flag,󰓎,}\
#[default]\
"

# active window format
setw -g window-status-current-format "\
#[bg=#{@SB_ACTIVE_WIN_BG},fg=#{@SB_ACTIVE_WIN_FG}]\
#F#I#W\
#{?window_bell_flag,󰂚,}\
#{?window_zoomed_flag,,}\
#{?window_activity_flag,@,}\
#{?window_marked_flag,󰓎,}\
#[default]\
"

setw -g window-status-separator " "

## Left status bar
set -g status-left-length 30
set -g status-left "\
#{?client_prefix,#[fg=red],\u00A0}\
#[bg=#{@SB_HOSTNAME_BG},fg=#{@SB_HOSTNAME_FG}] #{@SB_SSH} #[bold] #{@SB_HOSTNAME} #[default]\
#{?#{==:#S,0},,#S}\
#[default]\
"

## Right status bar.
# weather | time.
set -g status-right-length 25
set -g status-right "\
#(~/.dotfiles/bin/weather_status.sh)\
%b %d %Y %H:%M\
"

## Center status bar (window titles).
set -g status-justify centre

## Load any machine specific settings that are not version controlled.
if-shell "[ -f ~/.my_tmux.conf ]" 'source ~/.my_tmux.conf'
